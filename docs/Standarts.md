# Стандарты

## Стандарт оформления репозитория
    
[pds/skeleton](https://github.com/php-pds/skeleton/blob/1.x/README.md )

Каждое приложение которое требует спецефичиской настройки должно предоставить сооствествующий классы, 
реализующеее `rollun\installer\Install\InstallerInterface` интерфейс для ее проведения.

Более детально о [rollun-installer](https://github.com/rollun-com/rollun-installer).

Так же существует дериктория data, которая может содержать в себе требуемые временные файлы.
Напримре логи.

## Стандарт кодирование

[psr-2](http://www.php-fig.org/psr/psr-2/)

## Станларт наименования контейнеров(инстансов) 

Запущеный Контейнер должен именоваться по принципу `{server_name}-{vm_name}-{container_name}`
>vm-name требуется только в случае если на сервере существуют виртуальные машины.

Имя машины должно храниться в переменной окружения `MACHINE_NAME`
Она должна содержать имя в таком виде  `{server_name}-{vm_name}-{container_name}`.  
В случае если одной составляющей из данной цепочи не существует - пропустите ее.  
Пример:
* `ServerDrakon-ProductionVM-5000`
* `ServerDrakon-ProductionVM-`
* `ServerDrakon--5000`
* `ServerDrakon--`
 

## Стандарт ведения репозитория

Работа с репозиторием осуществляется по средсвам `git-workflow`.

Кратко

Главные ветви:
* develop
* master

Вспомогательные ветви:
* Ветви функциональностей (Feature branches)
* Ветви релизов (Release branches)
* Ветви исправлений (Hotfix branches)

Подробнее можно почитать тут:
 * [Git workflow](https://www.atlassian.com/git/tutorials/comparing-workflows/)
 * [Удачная модель ветвления для Git](https://habrahabr.ru/post/106912/)
 
## Конфиги и переменные окружения 
 
 Все важные и локальные конфигурации мы должны сохранять в перменных окружения, 
 либо как альтернатива в специальном конфиг файле. 
 
 Существует конфигурационный файл `config/env_config.php` который возвращает массив конфигурационных переменных.
 Имеет более низкиц приоритет чем переменная окружения, но возволяет задать настройки 
 там где нет возможности воспользоватся переменной окружения.
 public
 Так же есть файл-скрипт `config/env_configurator.php` который производит иницаилизацию глобальных констант 
 которые берет либо из переменных окружения либо из конфиг файла, в случае если переменная не задана - будет выброшена ошибка.
 
Для того что бы использовать данную возможность вы обязаны поместить `require_once 'config/env_configurator.php';
`в файле входа в приложение. 
 
 Список используемых переменных окружения
 * `APP_ENV` - Указывает тип приложения (может принимать значения `dev/prod`)
 * `MACHINE_NAME` - Указывает имя машины используя шиблон `{server_name}-{vm_name}-{container_name}`.
 * `HOST` - Адрес/домен по которому можно обратится к данному приложению
 * `DB_USER` - Имя пользователя для соединения с DB.
 * `DB_PASS` - Пароль для соединения с DB.
 
 Переменные можно переопределять с помощью http заголовка - `APP_ENV`, и через аргументы скрипта - `APP_ENV=val`.
 Переопрделение работает только в случае `dev -> prod`, но не на оборот.
  
  
 ### Конфиги expressive
 
 * dependencies - для указания глобальных сервисов.
 
 * errorhandler - обработчик ошибок **Whoops** работает только в `dev` окружении.
 
 * middleware-pipeline - конфиг для создания middleware-pipeline без фабрики и с возможностью укзаать приоритет выполения.
 
 * routes - конфиг для указания routes приложения. 
 
 * zend-expressive - конфиги для expressive.
 
 ###Префексы конфигфайлов
 
 Все конфиг файлы должны иметь префикс в виде имени библиотеки либо его сокращения.
 Пример:
 
 * ds - DataStore
 * sm - Service Manager
 
## Стандарты имен полей, таблицб БД
  
 Для всх названий используется стиль - under_score.
 
 ###Наименование БД
 
 * БД нужно называть заглавными буквами.
    >Название должны быть осмыслены.
  
 ###Наименование таблиц
 
 * Таблицы нужно называть множественным числом .
    Пример:
    * users
    * children
    * users_images
    
 ###Наименование полей
 
 * Поля нужно называть одиночным числом.
    Пример:
    * name
    * age
    * 
 
 * Имя поля 'простого' типа — Составное строчное имя отражающее содержимое поля.
     Пример:
     * name
     * age
 
 * Имя поля 'ссылочного' типа == наименование таблицы, на которую ссылается данное поле + суфикс «_id». 
    > Осмысленное название поля важнее следования правила.
    
    Пример:
    * parent_id
    * mother
 
 * Поля типа 'boolean', принимающие значения 1 или 0 == «Составное строчное имя» + «_flag».
    > «Составное строчное имя» должно отражать содержимое поля, при состоянии флага равному 1.
    
    Пример:
    * confirm_flag
    * active_flag
    
## Конфигурации routes

Все роуты которые:
* Используются для хуков - начинаются в `/webhook/`.
* API - начинаются в `/api/`.
* Закрытое API - начинаются в `/rest/`.

## Безопасность
Тесты нелья запускать на продакшн машине.
Локальные конфиги должнеы быть исключительно локальными - конфиги продакшна запрещено держать на dev машине.

## Зарезервированые аттрибуты запроса 

* user - Содержит массив записи текущего пользователя. (вместе с ролями)
* responseData - Данные которые будут переданы в ответ.
* Psr\Http\Message\ResponseInterface::class - обьект ответа.
* roles - роли текущего пользователя 
* resource - ресурс куда идет запрос 
* privilege - привилегия с которой идет запрос 
* identity - id текущего пользователя
* templateName - имя шаблона который будет отрендерен.
* returnResult - флаг для ответа при неправильной авторизации.